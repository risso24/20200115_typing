
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="style.css" />
    <title>タイピングゲーム</title>
  </head>
  <body>
    <!-- Firebaseの導入①
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>
    <!-- Firebaseの導入①　ここまで -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->

    <div id="typeGame">
      <div class="button-space">
        <button @click="countTimer()">ゲームを開始する</button>
      </div>
      <div class="quiz">
        <div class="sub-info">
          <div class="div-level">Level : {{level}}</div>
          <div class="sub-info-present">
            <div class="div-correct-number">
              現在の問題正解数：<span v-text="correctCheck"></span>/10
            </div>
            <div class="div-timer">WPM : {{ wpm }}</div>
            <div class="div-timer">残り{{ defaultTimer }}秒</div>
          </div>
        </div>
        <div class="sentence">
          <div class="div-question">
            {{ questions.quizSentence[quizNumber]}}
          </div>
          <div class="div-type-sentence">
            <span id="target">{{typedSentence}}</span>{{ currentSentence }}
          </div>
          <textarea
            v-model="typedSentence"
            @type="correctCheck()"
            id="startText"
            >
          </textarea>
        </div>
      </div>
    </div>
    <script>
      // Firebaseの導入②
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyCXgYOSDrFt6t-HzxpdDeHtWgMQBcnzzZc",
        authDomain: "typing-8e873.firebaseapp.com",
        databaseURL: "https://typing-8e873.firebaseio.com",
        projectId: "typing-8e873",
        storageBucket: "typing-8e873.appspot.com",
        messagingSenderId: "345313226622",
        appId: "1:345313226622:web:b2c33ecd61b2f7e8c00d2f",
        measurementId: "G-HBD9XSFC2Z"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
      // Firebaseの導入②　ここまで

      new Vue({
        el: "#typeGame",
        data: {
          display_button :true,
          display_quiz: false,
          correctNumber: 0,
          level: 1,
          defaultTimer: "",
          wpm: 100,
          quizNumber: 0,
          timers: [],
          defaultFontColor: "red",
          defaultBackgroundColor: "#fff",
          defaultFontSize : "16px",
          defaultFontFamily : "sans-serif",
          // 0: key, 1:value , 3:quizSentence, 4:typeSentence
          questions: {[
            [
              "font-color",
              "blue",
              "color: blue;",
              "color: blue;"
            ],
            [
            "font-size",
              "30px",
              "font-size: 30px;",
              "font-size: 30px;"
            ],
            [
            "font-family",
              "30px",
              "font-size: 30px;",
              "font-size: 30px;"
            ],
            [   

            "Times New Roman"
                   ]]
          },
          typedSentence: ""
        },
        computed: {
          // 入力された文章/問題の文章切り替え
          currentSentence() {
            const numberOfTyped = this.typedSentence.length;
            const nowQuiz = this.questions.typeSentence[this.quizNumber];
            const restSentence = nowQuiz.slice(numberOfTyped);
            return restSentence;
          },
          changeElements() {
            switch (this.questions.partOfKey){
              case "font-color":
                this.defaultFontColor = this.questions.partOfValue[this.quizNumber];
              case "font-size":
                this.defaultFontSize = this.questions.partOfValue[this.quizNumber];
              case "background-color":
                this.defaultBackgroundColor = this.questions.partOfValue[this.quizNumber];
              case "font-size":
                this.defaultFontFamily = this.questions.partOfValue[this.quizNumber];
              
            }
          },
          correctCheck() {
            const typedText = this.typedSentence.length;
            //タイプ間違えたら色が変わる
            if (this.typedSentence !== this.questions.typeSentence[this.quizNumber].slice(0, typedText)) {
              document.getElementById("target").style.backgroundColor = this.defaultFontColor;
              document.getElementById("target").style.color = "#fff";
            } else {
              document.getElementById("target").style.backgroundColor = "#fff";
              document.getElementById("target").style.color = "red";
            }

            //正解したら正解数アップ&10問正解でレベルアップ
            if (this.typedSentence === this.questions.typeSentence[this.quizNumber]) {
              this.changeElements();
              this.correctNumber++;
              if (this.correctNumber > 9)
              { this.level++;
                this.wpm = this.wpm + 50;
                this.correctNumber = 0;
            }
              this.countTimer();
            }
            return this.correctNumber;
          }

        },
        methods: {
          // クイズ（番号のリセット
          resetQuiz() {
            this.typedSentence = "";
            const newQuizNumber = Math.floor(
              Math.random() * this.questions.typeSentence.length
            );
            this.quizNumber = newQuizNumber;
          },
          // 文字数に合わせて制限時間を変更
          getTimer() {
            const lengthOfSentence = this.questions.typeSentence[this.quizNumber].length;
              this.defaultTimer = Math.floor((
                lengthOfSentence * (60 / this.wpm)
              ));
          },
          // タイマーリセット
          resetTimer() {
            this.timers.map((timer) => clearTimeout(timer))
            this.timers = []
          },
          countTimer() {
            this.resetTimer() // すでに登録済みのタイマーをリセット
            const countdown = () => {
                this.defaultTimer--;
                const timer = setTimeout(countdown, 1000);
                this.timers.push(timer) // 登録したタイマーを保存
                if (this.defaultTimer < 0) {
                  this.resetQuiz();
                  this.getTimer();
                  countdown();
                }
              }
            document.getElementById('startText').focus();
            this.resetQuiz();
            this.getTimer();
            countdown();
          }
        }
      });
    </script>
  </body>
</html>
